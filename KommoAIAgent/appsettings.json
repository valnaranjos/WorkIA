{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",


  "Kommo": {
    "BaseUrl": "https://serticlouddesarrollo.kommo.com",
    "AccessToken": "",
    "CustomFieldIds": {
      "MensajeIA": 779638
    }
  },
  "OpenAI": {
    "ApiKey": "sk-svcacct-",
    "Model": "gpt-4o-mini",
    "MaxOutputTokens": 500
  },
  "Debounce": { // Configuración para evitar procesar el mismo webhook múltiples veces en un corto período, para que el cliente tenga espacio de enviar vario mensajes seguidos.
    "WindowMs": 2000, // Ventana de tiempo en milisegundos para agrupar mensajes (2 segundos).
    "MaxBurstMs": 8000 // Tiempo máximo que se puede extender la ventana si llegan más mensajes (8 segundos), después de este tiempo se fuerza el procesamiento.
  },
  "MultiTenancy": {
    "DefaultTenant": "serticlouddesarrollo",
    "Tenants": [
      {
        "Slug": "serticlouddesarrollo",
        "DisplayName": "Serticloud (Dev)",
        "Kommo": {
          "BaseUrl": "https://serticlouddesarrollo.kommo.com",
          "AccessToken": "..----",
          "FieldIds": {
            "MensajeIA": 779638
          }
        },
        "OpenAI": {
          "ApiKey": "sk-svcacct-",
          "Model": "gpt-4o-mini",
          "VisionModel": "gpt-4o"
        },

        "Memory": {
          // para no caer en memoria de proceso (fallback)
          "Redis": {
            "ConnectionString": "localhost:6379",
            "Prefix": "kommoai"
          },
          "TTLMinutes": 120 // cuánto dura el historial (por lead) antes de expirar
        },
        "Budgets": {
          "DailyTokenLimit": 400000, // tope de tokens por día
          "BurstPerMinute": 12 // cuántos turnos IA permites por minuto
        },
        "Debounce": {
          "WindowMs": 2000,
          "MaxBurstMs": 8000,
          "ForceFlush": {
            "MaxFragments": 6,
            "MaxChars": 1400
          }
        }
      },
      {
        "Slug": "serticloud", // ← prod
        "DisplayName": "Serticloud (Prod)",
        "Kommo": {
          "BaseUrl": "https://serticloud.kommo.com",
          "AccessToken": "***",
          "FieldIds": {
            "MensajeIA": 779638
          }
        },
        "OpenAI": {
          "ApiKey": "sk-***",
          "Model": "gpt-4o-mini",
          "VisionModel": "gpt-4o"
        },

        "Memory": {
          // para no caer en memoria de proceso (fallback)
          "Redis": {
            "ConnectionString": "my-redis.xxxxxx.use1.cache.amazonaws.com:6379,ssl=true,abortConnect=false,password=__ENV:REDIS_AUTH_TOKEN__", // Endpoint de ElasticCache en AWS. 
            "Prefix": "kommoai" //Evita colisiones con nombre único para este proyecto.
          },
          "TTLMinutes": 120 // cuánto dura el historial (por lead) antes de expirar
        },

        // Presupuestos / rate-limits por tenant
        "Budgets": {
          "DailyTokenLimit": 400000, // tope de tokens por día
          "BurstPerMinute": 12 // cuántos turnos IA permites por minuto
        },
        "Debounce": {
          "WindowMs": 2000,
          "MaxBurstMs": 8000,
          "ForceFlush": {
            "MaxFragments": 6,
            "MaxChars": 1400
          }
        }
      }
    ]
  }
}
